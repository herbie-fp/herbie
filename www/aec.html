<html>
<head>
  <meta charset="utf-8" />
  <title>Herbie AEC Instructions</title>
  <style>
    html {font-family: sans-serif;}
    body {min-width: 400px; max-width: 650px; margin: 3em auto;}
    h1, h2, h3 {letter-spacing: .125em; font-weight: 600;}
    h1 {font-size: 18px; line-height: 1; margin: 1.5em 0 .5em 0;}
    h2 {font-size: 16px; line-height: 1.125; margin: 2.5em 0 .25em;}
    h3 {font-size: 14px; line-height: 1.286; margin: 1.5em 0 .114em;}
    .hide-text {background-color: #f1f1f1; cursor: pointer; padding: .5em; margin: 1em;}
    p, li, dd, blockquote, figcaption {
      font-size: 15px; line-height: 1.2; margin: .5em;
      text-align: justify; -moz-hyphens: auto; -webkit-hyphens: auto; hyphens: auto;}
    figcaption {font-size: 14px; line-height: 1.1;}
    header h1 {margin: .5em 0 0 0; font-size: 16pt;}
    header p {font-size: 14pt; margin: .5em 0 0 0;}
    header img {position: relative; top: -1em; float: left; width: 133px; margin: 0 2em 0 0;}
    header {margin: 2em 0 1em 0;}
    header + * {clear: both;}
    pre, dt {padding-left: 1.5em; font-size: 16px; font-family: monospace; background-color: #f1f1f1;}
  </style>
</head>
<body>
  <header>
    <img alt="Herbie" src="data:image/png;base64,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" />
    <h1>Herbie (#61)</h1>
    <p>AEC Evaluation</p>
  </header>

  <p>
    These are instructions for evaluating Herbie,
    the artifact for PLDI 2015 paper #61.
    The main downloads for this artifact are the
    <a href="paper.pdf">Submitted paper</a> and the <a href="image.ova">VirtualBox Image</a>,
    along with these instructions.
  </p>

  <h2>Installing Herbie</h2>

  <p>
    There are three ways to try out Herbie.
    The simplest is to use a VirtualBox image to run Herbie;
    for users familiar with Docker,
    Herbie provides a Docker image which may be more convenient;
    and Herbie can also be built and run from source.
  </p>

  <h3>Virtual machine</h3>

  <p>
    To run Herbie in a virtual machine,
    <a href="vm.vmx">download</a> the virtual machine image,
    start VirtualBox, and start the image in VirtualBox.
    (VMs other than VirtualBox should also work; however, this has not been tested.)
  </p>

  <p>
    The virtual machine will start into a graphical desktop
    with two icons on the desktop:
  </p>

  <ul>
    <li><code>Results</code>, which holds Herbie's output. It contains a recent run's results.</li>
    <li><code>README.html</code>, which are a copy of these instructions.</li>
  </ul>

  <p>
    In the virtual machine, Herbie can be run with the <code>herbie</code> command.
    In case you want to install additional software in the VM,
    the machine is a standard Ubuntu 14.04 Desktop installation,
    with username <kbd>aec</kdb> and password <kbd>password</kbd>.
  </p>

  <div id="hidable" data-hidetext="Instructions for using Docker or source are hidden; click here to show them.">
  <h3>Docker image</h3>

  <p>
    To run Herbie through Docker,
    <a href="https://docs.docker.com/installation/">install Docker</a>
    and download the Herbie image to your computer with:
  </p>

  <pre>docker pull pldi15num61/herbie</pre>

  <p>
    Create a folder for Herbie to place its results into:
  </p>

  <pre>mkdir Results</pre>

  <p>
    You can now run Herbie with the incantation
  </p>

  <pre>docker run -it -v $PWD/Results/:/herbie/graphs pldi15num61/herbie</pre>

  <p>
    For convenience create an alias for this command in your shell.
    In Bash, you would do this by executing:
  </p>

  <pre>alias herbie=docker run -it -v $PWD/Results/:/herbie/graphs pldi15num61/herbie</pre>

  <h3>Installing from source</h3>

  <p>
    Herbie is developed on <a href="https://github.com/uwplse/herbie">Github</a>
    in <a href="https://racket-lang.org">Racket</a>.
    To run Herbie, you'll need to <a href="http://download.racket-lang.org/">install Racket</a>.
    Take care to use the official installer,
    instead of using your distribution's package manager or a tool like OS X Homebrew.
    These repositories often have out-of-date Racket version (Herbie requires 6.1)
    or buggy versions of Racket's bundled mathematics libraries.
    Note that Herbie's <code>git</code> history contains the names of Herbie's authors,
    so this method may sacrifice double-blind evaluation.
  </p>

  <p>
    Herbie's source can be downloaded with:
  </p>

  <pre>git clone https://github.com/uwplse/herbie.git herbie</pre>

  <p>
    Build Herbie by running:
  </p>

  <pre>cd herbie && raco make herbie/reports/make-report.rkt</pre>

  <p>
    Herbie can now be run with:
  </p>

  <pre>racket herbie/reports/make-report.rkt</pre>

  <p>
    For convenience create an alias for this command in your shell.
    In Bash, you would do this by executing:
  </p>

  <pre>alias herbie=racket herbie/reports/make-report.rkt</pre>

  <p>
    Unlike for the virtual machine or the Docker image,
    results will appear in <code>graphs/</code>
    inside the Herbie source directory.
  </p>
  </div>
  <script>
    var h = document.getElementById("hidable");
    var t = document.createElement("div");
    t.className = "hide-text";
    t.innerHTML = h.dataset.hidetext;
    h.parentNode.replaceChild(t, h);
    t.addEventListener("click", function(){t.parentNode.replaceChild(h, t)});
  </script>

  <h2>Evaluating Herbie</h2>

  <p>
    Now that Herbie is installed and can be run,
    there are several experiments you can perform
    to reproduce the results in the paper.
    These instructions assume the <code>herbie</code> alias
    has been defined as in the instructions above.
  </p>

  <h3>Reproducing the main evaluation</h3>
  <p>
    To reproduce the results from the main evaluation, run:
  </p>

  <pre>herbie bench/hamming</pre>

  <p>
    This command will take a while to run
    and demands at least two gigabytes of memory to complete.
    (Runtime can be anywhere from five minutes to an hour,
    depending on the number of CPUs available,
    the available memory,
    and the speed of the machine.
    In a virtual machine, this may take longer yet).
  </p>

  <p>
    Once complete, open <code>report.html</code>,
    from the results folder, in a browser.
    (The page has been mostly tested in Firefox,
    but should work in all modern browsers.)
    Note that each invocation of <code>herbie</code>
    will overwrite this report page.
    The top of the page should contain a graphic
    similar to the double precision results in Figure 7 from the paper.
  </p>

  <p>
    The results in the figure may not be exactly identical to that in the paper,
    due to the following reasons:
  </p>

  <ul>
    <li>
      Herbie has improved somewhat since the submitted paper,
      so may produce somewhat better results on a few tests.
    </li>
    <li>
      The plot drawn on the results page is generated by sampling 8196 points,
      instead of the 100â€Š000 used in the paper.
    </li>
    <li>
      The random seed used by Herbie is different on every evaluation,
      which changes the sample points used by Herbie and thus its results.
    </li>
  </ul>

  <p>
    We do not expect any of these sources of error to lead to significant difference in the results.
  </p>

  <p>
    The rest of the report contains various details of how Herbie achieved its results
    and several metrics for evaluating them.
    We did not discuss these metrics in the paper, but invite the artifact evaluator to explore them.
    For each benchmark, the <code>Target bits</code> column represents
    the average bits correct for Hamming's answer, when known.
  </p>

  <h3>Reproducing the extended test suite evaluation</h3>

  <p>
    To reproduce Herbie's results on the extended evaluation, execute:
  </p>

  <pre>herbie bench</pre>

  <p>
    This command may take several hours to execute,
    and is expected to require as much as four gigabytes of memory.
    The results will again be summarized in <code>report.html</code>.
    Note that for the numeric results reported in the paper,
    only some of the test cases were considered.
    (Herbie's complete benchmarks contain several trivial or duplicate benchmarks,
    since the same formula sometimes shows up in multiple places;
    these were ignored in the reported results.)
  </p>

  <h2>More things to do with Herbie</h2>

  <p>
    Herbie supports several additional options,
    which can be used to explore the effect of other parameters.
    These options are summarized by <code>herbie --help</code>:
  </p>

  <dl>
    <dt>-r <var>R</var></dt>
    <dd>A random seed to use; a fixed seed is stored in the <code>SEED</code> environment variable. Omitting this argument asks Herbie to choose a new seed.</dd>
    <dt>-n <var>N</var></dt>
    <dd>Number of iterations of the main loop to use.</dd>
    <dt>-s <var>N</var></dt>
    <dd>Number of sample points to use during the internal search.</dd>
    <dt>-f <var>category</var>:<var>flag</var></dt>
    <dd>
      Toggle flags that govern Herbie's search. This option can be repeated.
      If both <code>sample:double</code> and <code>precision:double</code> are toggled,
      Herbie will search for improvements in single-precision mode.
      The other flags turn off various parts of Herbie's search, and are not recommended.
    </dd>
  </dl>

  <h3>Writing new tests</h3>

  <p>
    New benchmarks can also be written and passed to Herbie.
    To do this, create a new file in <code>bench/</code> named <code><var>something</var>.rkt</code>.
    This file should be in a standard format; see <code>bench/basic.rkt</code> for an example.
    Herbie should now be run so:
  </p>

  <pre>herbie bench/<var>something</var>.rkt</pre>

  <p>
    A report is produced as usual.
  </p>
  
</body>
